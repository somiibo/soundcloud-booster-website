---
### ALL PAGES ###
layout: master/admin/main
permalink: /admin/dashboard/
sitemap:
  include: false

### REGULAR PAGES ###
meta:
  title: "Dashboard"
  description: "Manage {{ site.brand.name }} via this helpful dashboard."
  breadcrumb: "Dashboard"
  index: false
---
<div id="admin-result-error" class="alert alert-soft-danger" role="alert" hidden>
  <h4 class="alert-heading">Error!</h4>
  <p class="mb-0 admin-result-message">There was an error completing your request.</p>
</div>

<!-- Card -->
<div class="card card-body mb-3 mb-lg-5">
  <div class="row col-md-divider gx-lg-6">
    <div class="col-md-3">
      <!-- Media -->
      <div class="d-flex">
        <div class="flex-grow-1">
          <h6 class="card-subtitle mb-3">Total users</h6>
          <h3 id="stats-users-total-current" class="card-title"><div class="spinner-border text-primary spinner-border-sm" role="status"></div></h3>

          <div class="d-flex align-items-center">
            <span id="stats-users-total-previous" class="d-block fs-6"></span>

            <span id="stats-users-total-icon" class="badge bg-soft-primary text-primary ms-2">
              <!-- <i class="bi-graph-up"></i> 0.0% -->
            </span>
          </div>
        </div>

        <span class="icon icon-soft-secondary icon-sm icon-circle ms-3">
          <i class="bi-people"></i>
        </span>
      </div>
      <!-- End Media -->
    </div>
    <!-- End Col -->

    <div class="col-md-3">
      <!-- Media -->
      <div class="d-flex">
        <div class="flex-grow-1">
          <h6 class="card-subtitle mb-3">Online Users</h6>
          <h3 id="stats-users-online-current" class="card-title"><div class="spinner-border text-primary spinner-border-sm" role="status"></div></h3>

          <div class="d-flex align-items-center">
            <span id="stats-users-online-previous" class="d-block fs-6"></span>
            <span id="stats-users-online-icon" class="badge bg-soft-primary text-primary ms-2">
              <!-- <i class="bi-graph-up"></i> 0.0% -->
            </span>
          </div>
        </div>

        <span class="icon icon-soft-secondary icon-sm icon-circle ms-3">
          <i class="bi-globe"></i>
        </span>
      </div>
      <!-- End Media -->
    </div>
    <!-- End Col -->

    <div class="col-md-3">
      <!-- Media -->
      <div class="d-flex">
        <div class="flex-grow-1">
          <h6 class="card-subtitle mb-3">Notifications</h6>
          <h3 id="stats-notification-subscribers-current" class="card-title"><div class="spinner-border text-primary spinner-border-sm" role="status"></div></h3>

          <div class="d-flex align-items-center">
            <span id="stats-notification-subscribers-previous" class="d-block fs-6"></span>
            <span id="stats-notification-subscribers-icon" class="badge bg-soft-primary text-primary ms-2">
              <!-- <i class="bi-graph-up"></i> 0.0% -->
            </span>
          </div>
        </div>

        <span class="icon icon-soft-secondary icon-sm icon-circle ms-3">
          <i class="bi-bell"></i>
        </span>
      </div>
      <!-- End Media -->
    </div>
    <!-- End Col -->

    <div class="col-md-3">
      <!-- Media -->
      <div class="d-flex">
        <div class="flex-grow-1">
          <h6 class="card-subtitle mb-3">Subscribers</h6>
          <h3 id="stats-premium-subscribers-current" class="card-title"><div class="spinner-border text-primary spinner-border-sm" role="status"></div></h3>

          <div class="d-flex align-items-center">
            <span id="stats-premium-subscribers-previous" class="d-block fs-6"></span>
            <span id="stats-premium-subscribers-icon" class="badge bg-soft-primary text-primary ms-2">
              <!-- <i class="bi-graph-up"></i> 0.0% -->
            </span>
          </div>
        </div>

        <span class="icon icon-soft-secondary icon-sm icon-circle ms-3">
          <i class="bi-piggy-bank"></i>
        </span>
      </div>
      <!-- End Media -->
    </div>
    <!-- End Col -->
  </div>
  <!-- End Row -->
</div>
<!-- End Card -->

<div class="card mb-3 mb-lg-5">
  <div class="card-header border-bottom">
    <h4 class="card-header-title">Subscription breakdown</h4>
  </div>

  <!-- Body -->
  <div class="card-body">
    <div id="subscription-breakdown-spinner" class="">
      <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status"></div>
      </div>
    </div>

    <!-- List Group -->
    <ul id="subscription-breakdown-parent" class="list-group" hidden>

    </ul>
    <!-- End List Group -->
  </div>
  <!-- End Body -->
</div>


<!-- Card -->
<div class="card mb-3 mb-lg-5" hidden>
  <!-- Header -->
  <div class="card-header card-header-content-sm-between">
    <h4 class="card-header-title mb-2 mb-sm-0">Sales <i class="bi-question-circle text-body ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Net sales (gross sales minus discounts and returns) plus taxes and shipping. Includes orders from all sales channels."></i></h4>

    <div class="d-grid d-sm-flex gap-2">
      <!-- Select -->
      <div class="tom-select-custom">
        <select class="js-select form-select form-select-sm" autocomplete="off" data-hs-tom-select-options='{
                  "searchInDropdown": false,
                  "hideSearch": true,
                  "dropdownWidth": "10rem"
                }'>
          <option value="online-store">Online store</option>
          <option value="in-store">In-store</option>
        </select>
      </div>
      <!-- End Select -->

      <!-- Daterangepicker -->
      <button id="js-daterangepicker-predefined" class="btn btn-white btn-sm dropdown-toggle">
        <i class="bi-calendar-week"></i>
        <span class="js-daterangepicker-predefined-preview ms-1"></span>
      </button>
      <!-- End Daterangepicker -->
    </div>
  </div>
  <!-- End Header -->

  <!-- Body -->
  <div class="card-body">
    <div class="row col-lg-divider">
      <div class="col-lg-9 mb-5 mb-lg-0">
        <!-- Bar Chart -->
        <div class="chartjs-custom mb-4">
          <canvas id="ecommerce-sales" class="js-chart" style="height: 15rem;" data-hs-chartjs-options='{
                    "type": "bar",
                    "data": {
                      "labels": ["1AM","2AM","3AM","4AM","5AM","6AM","7AM","8AM","9AM","10AM","11AM"],
                      "datasets": [{
                        "data": [200, 300, 290, 350, 150, 350, 300, 100, 125, 220, 200, 300, 290, 350, 150, 350, 300, 100, 125, 220, 225],
                        "backgroundColor": "#377dff",
                        "hoverBackgroundColor": "#377dff",
                        "borderColor": "#377dff"
                      },
                      {
                        "data": [150, 230, 382, 204, 169, 290, 300, 100, 300, 225, 120, 150, 230, 382, 204, 169, 290, 300, 100, 300, 140],
                        "backgroundColor": "#e7eaf3",
                        "borderColor": "#e7eaf3"
                      }]
                    },
                    "options": {
                      "scales": {
                        "yAxes": [{
                          "gridLines": {
                            "color": "#e7eaf3",
                            "drawBorder": false,
                            "zeroLineColor": "#e7eaf3"
                          },
                          "ticks": {
                            "beginAtZero": true,
                            "stepSize": 100,
                            "fontSize": 12,
                            "fontColor": "#97a4af",
                            "fontFamily": "Open Sans, sans-serif",
                            "padding": 10
                          }
                        }],
                        "xAxes": [{
                          "gridLines": {
                            "display": false,
                            "drawBorder": false
                          },
                          "ticks": {
                            "fontSize": 12,
                            "fontColor": "#97a4af",
                            "fontFamily": "Open Sans, sans-serif",
                            "padding": 5
                          },
                          "categoryPercentage": 0.5,
                          "maxBarThickness": "10"
                        }]
                      },
                      "cornerRadius": 2,
                      "tooltips": {
                        "hasIndicator": true,
                        "mode": "index",
                        "intersect": false
                      },
                      "hover": {
                        "mode": "nearest",
                        "intersect": true
                      }
                    }
                  }'></canvas>
        </div>
        <!-- End Bar Chart -->

        <div class="row justify-content-center">
          <div class="col-auto">
            <span class="legend-indicator"></span> Revenue
          </div>
          <!-- End Col -->

          <div class="col-auto">
            <span class="legend-indicator bg-primary"></span> Orders
          </div>
          <!-- End Col -->
        </div>
        <!-- End Row -->
      </div>

      <div class="col-lg-3">
        <div class="row">
          <div class="col-sm-6 col-lg-12">
            <!-- Stats -->
            <div class="d-flex justify-content-center flex-column" style="min-height: 9rem;">
              <h6 class="card-subtitle">Revenue</h6>
              <span class="d-block display-4 text-dark mb-1 me-3">$97,458.20</span>
              <span class="d-block text-success">
                <i class="bi-graph-up me-1"></i> $2,401.02 (3.7%)
              </span>
            </div>
            <!-- End Stats -->

            <hr class="d-none d-lg-block my-0">
          </div>
          <!-- End Col -->

          <div class="col-sm-6 col-lg-12">
            <!-- Stats -->
            <div class="d-flex justify-content-center flex-column" style="min-height: 9rem;">
              <h6 class="card-subtitle">Orders</h6>
              <span class="d-block display-4 text-dark mb-1 me-3">67,893</span>
              <span class="d-block text-danger">
                <i class="bi-graph-down me-1"></i> +3,301 (1.2%)
              </span>
            </div>
            <!-- End Stats -->
          </div>
          <!-- End Col -->
        </div>
        <!-- End Row -->
      </div>
    </div>
    <!-- End Row -->
  </div>
  <!-- End Body -->
</div>
<!-- End Card -->

<div class="row">
  <div class="col-md-6">
    <a class="card card-hover-shadow" href="{{ site.url }}/admin/notifications/create">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-shrink-0">
            <img class="avatar avatar-lg avatar-4x3" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/svg/illustrations/oc-megaphone.svg" alt="Image Description" style="min-height: 5rem;" data-hs-theme-appearance="default">
            <img class="avatar avatar-lg avatar-4x3" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/svg/illustrations-light/oc-megaphone.svg" alt="Image Description" style="min-height: 5rem;" data-hs-theme-appearance="dark">
          </div>

          <div class="flex-grow-1 ms-4">
            <h3 class="text-inherit mb-1">Notifications</h3>
            <span class="text-body">Send a notification</span>
          </div>

          <div class="ms-2 text-end">
            <i class="bi-chevron-right text-body text-inherit"></i>
          </div>
        </div>
      </div>
    </a>
  </div>

  <div class="col-md-6">
    <a class="card card-hover-shadow" href="{{ site.url }}/admin/posts/create">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-shrink-0">
            <img class="avatar avatar-lg avatar-4x3" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/svg/illustrations/oc-looking-for-answers.svg" alt="Image Description" style="min-height: 5rem;" data-hs-theme-appearance="default">
            <img class="avatar avatar-lg avatar-4x3" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/svg/illustrations-light/oc-looking-for-answers.svg" alt="Image Description" style="min-height: 5rem;" data-hs-theme-appearance="dark">
          </div>

          <div class="flex-grow-1 ms-4">
            <h3 class="text-inherit mb-1">Post</h3>
            <span class="text-body">Create a blog post</span>
          </div>

          <div class="ms-2 text-end">
            <i class="bi-chevron-right text-body text-inherit"></i>
          </div>
        </div>
      </div>
    </a>
  </div>

  <!-- <div class="col-lg-4 mb-3 mb-lg-5"> -->
  <div class="col-lg-12 mb-3 mb-lg-5" hidden>
    <div class="d-grid gap-2 gap-lg-4">
      <!-- Card -->

      <!-- End Card -->

      <!-- Card -->

      <!-- End Card -->

      <!-- Card -->
      <a class="card card-hover-shadow" href="#" hidden>
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <img class="avatar avatar-lg avatar-4x3" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/svg/illustrations/oc-discount.svg" alt="Image Description" style="min-height: 5rem;" data-hs-theme-appearance="default">
              <img class="avatar avatar-lg avatar-4x3" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/svg/illustrations-light/oc-discount.svg" alt="Image Description" style="min-height: 5rem;" data-hs-theme-appearance="dark">
            </div>

            <div class="flex-grow-1 ms-4">
              <h3 class="text-inherit mb-1">Discount</h3>
              <span class="text-body">Create a new discount</span>
            </div>

            <div class="ms-2 text-end">
              <i class="bi-chevron-right text-body text-inherit"></i>
            </div>
          </div>
        </div>
      </a>
      <!-- End Card -->
    </div>
  </div>
  <!-- End Col -->

  <div class="col-lg-8 mb-3 mb-lg-5" hidden>
    <!-- Card -->
    <div class="card h-100">
      <!-- Header -->
      <div class="card-header card-header-content-between">
        <h4 class="card-header-title">Top products</h4>

        <a class="btn btn-ghost-secondary btn-sm" href="#">View all</a>
      </div>
      <!-- End Header -->

      <!-- Body -->
      <div class="card-body-height">
        <!-- Table -->
        <div class="table-responsive">
          <table class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table">
            <thead class="thead-light">
              <tr>
                <th scope="col">Item</th>
                <th scope="col">Change</th>
                <th scope="col">Price</th>
                <th scope="col">Sold</th>
                <th scope="col">Sales</th>
              </tr>
            </thead>

            <tbody>
              <tr>
                <td>
                  <!-- Media -->
                  <a class="d-flex align-items-center" href="./ecommerce-product-details.html">
                    <div class="flex-shrink-0">
                      <img class="avatar" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/assets/img/400x400/img4.jpg" alt="Image Description">
                    </div>

                    <div class="flex-grow-1 ms-3">
                      <h5 class="text-inherit mb-0">Photive wireless speakers</h5>
                    </div>
                  </a>
                  <!-- End Media -->
                </td>
                <td><i class="bi-graph-down text-danger me-1"></i> 72%</td>
                <td>$65</td>
                <td>7,545</td>
                <td>
                  <h4 class="mb-0">$15,302.00</h4>
                </td>
              </tr>

              <tr>
                <td>
                  <!-- Media -->
                  <a class="d-flex align-items-center" href="./ecommerce-product-details.html">
                    <div class="flex-shrink-0">
                      <img class="avatar" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/assets/img/400x400/img26.jpg" alt="Image Description">
                    </div>

                    <div class="flex-grow-1 ms-3">
                      <h5 class="text-inherit mb-0">Topman shoe in green</h5>
                    </div>
                  </a>
                  <!-- End Media -->
                </td>
                <td><i class="bi-graph-up text-success me-1"></i> 69%</td>
                <td>$21</td>
                <td>6,643</td>
                <td>
                  <h4 class="mb-0">$12,492.21</h4>
                </td>
              </tr>

              <tr>
                <td>
                  <!-- Media -->
                  <a class="d-flex align-items-center" href="./ecommerce-product-details.html">
                    <div class="flex-shrink-0">
                      <img class="avatar" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/assets/img/400x400/img25.jpg" alt="Image Description">
                    </div>

                    <div class="flex-grow-1 ms-3">
                      <h5 class="text-inherit mb-0">RayBan black sunglasses</h5>
                    </div>
                  </a>
                  <!-- End Media -->
                </td>
                <td><i class="bi-graph-down text-danger me-1"></i> 65%</td>
                <td>$37</td>
                <td>5,951</td>
                <td>
                  <h4 class="mb-0">$10,351.71</h4>
                </td>
              </tr>

              <tr>
                <td>
                  <!-- Media -->
                  <a class="d-flex align-items-center" href="./ecommerce-product-details.html">
                    <div class="flex-shrink-0">
                      <img class="avatar" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/assets/img/400x400/img6.jpg" alt="Image Description">
                    </div>

                    <div class="flex-grow-1 ms-3">
                      <h5 class="text-inherit mb-0">Mango Women's shoe</h5>
                    </div>
                  </a>
                  <!-- End Media -->
                </td>
                <td><i class="bi-graph-down text-danger me-1"></i> 53%</td>
                <td>$65</td>
                <td>5,002</td>
                <td>
                  <h4 class="mb-0">$9,917.45</h4>
                </td>
              </tr>

              <tr>
                <td>
                  <!-- Media -->
                  <a class="d-flex align-items-center" href="./ecommerce-product-details.html">
                    <div class="flex-shrink-0">
                      <img class="avatar" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/assets/img/400x400/img3.jpg" alt="Image Description">
                    </div>

                    <div class="flex-grow-1 ms-3">
                      <h5 class="text-inherit mb-0">Calvin Klein t-shirts</h5>
                    </div>
                  </a>
                  <!-- End Media -->
                </td>
                <td><i class="bi-graph-up text-success me-1"></i> 50%</td>
                <td>$89</td>
                <td>4,714</td>
                <td>
                  <h4 class="mb-0">$8,466.02</h4>
                </td>
              </tr>

              <tr>
                <td>
                  <!-- Media -->
                  <a class="d-flex align-items-center" href="./ecommerce-product-details.html">
                    <div class="flex-shrink-0">
                      <img class="avatar" src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/assets/img/400x400/img5.jpg" alt="Image Description">
                    </div>

                    <div class="flex-grow-1 ms-3">
                      <h5 class="text-inherit mb-0">Givenchy perfume</h5>
                    </div>
                  </a>
                  <!-- End Media -->
                </td>
                <td><i class="bi-graph-up text-success me-1"></i> 50%</td>
                <td>$99</td>
                <td>4,155</td>
                <td>
                  <h4 class="mb-0">$7,715.89</h4>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- End Table -->
      </div>
      <!-- End Body -->
    </div>
    <!-- End Card -->
  </div>
  <!-- End Col -->
</div>
<!-- End Row -->
<script type="text/javascript">

  var subscriptionPlanTemplate = `
    <li class="list-group-item">
      <div class="mb-2">
        <h5>{name} <span class="badge bg-primary ms-1">Plan</span></h5>
      </div>

      <div class="d-flex align-items-md-center">
        <div class="flex-shrink-0">
          <span class="display-3 text-dark">{countTotal}</span>
        </div>

        <div class="flex-grow-1 ms-3">
          <div class="row mx-md-n3">
            <div class="col-md px-md-4">
              <span class="d-block">Total</span>
              <span class="badge bg-soft-primary text-primary p-1">
                <i class="bi-graph-up"></i> +0 subscribers
              </span>
            </div>

            <div class="col-md-9 col-lg-10 column-md-divider px-md-4">
              <div class="row justify-content-start mb-2">
                <div class="col-auto">
                  <span class="legend-indicator bg-primary"></span>
                  Monthly ({countMonthly})
                </div>

                <div class="col-auto">
                  <span class="legend-indicator bg-success"></span>
                  Annually ({countAnnually})
                </div>

              </div>

              <div class="progress rounded-pill" style="height: 0.75rem;">
                <div class="progress-bar" role="progressbar" style="width: {percentMonthly}%" aria-valuenow="{percentMonthly}" aria-valuemin="0" aria-valuemax="100">{percentMonthlyVisual}</div>
                <div class="progress-bar bg-success" role="progressbar" style="width: {percentAnnually}%" aria-valuenow="{percentAnnually}" aria-valuemin="0" aria-valuemax="100">{percentAnnuallyVisual}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </li>
  `

  Manager.auth().ready(function(user) {
    var serverDev = 'http://localhost:5001/' + Manager.properties.options.libraries.firebase_app.config.projectId + '/us-central1/bm_api';
    var serverProd = 'https://us-central1-' + Manager.properties.options.libraries.firebase_app.config.projectId + '.cloudfunctions.net/bm_api';

    var statsUsersTotalCurrentEl = document.getElementById('stats-users-total-current');
    var statsUsersTotalPreviousEl = document.getElementById('stats-users-total-previous');
    var statsUsersTotalIconEl = Manager.dom().select('#stats-users-total-icon');

    var statsUsersOnlineCurrentEl = document.getElementById('stats-users-online-current');
    var statsUsersOnlinePreviousEl = document.getElementById('stats-users-online-previous');
    var statsUsersOnlineIconEl = Manager.dom().select('#stats-users-online-icon');

    var statsNotificationSubscribersCurrentEl = document.getElementById('stats-notification-subscribers-current');
    var statsNotificationSubscribersPreviousEl = document.getElementById('stats-notification-subscribers-previous');
    var statsNotificationSubscribersIconEl = Manager.dom().select('#stats-notification-subscribers-icon');

    var statsPremiumSubscribersCurrentEl = document.getElementById('stats-premium-subscribers-current');
    var statsPremiumSubscribersPreviousEl = document.getElementById('stats-premium-subscribers-previous');
    var statsPremiumSubscribersIconEl = Manager.dom().select('#stats-premium-subscribers-icon');

    var subscriptionBreakdownParentEl = document.getElementById('subscription-breakdown-parent');
    var subscriptionBreakdownSpinnerEl = document.getElementById('subscription-breakdown-spinner');

    // https://stackoverflow.com/a/2901298/7305269
    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function calculateDifference(newN, oldN) {
      var number = (((newN - oldN) * 100) / oldN);
      return (number === Infinity || isNaN(number) ? 0 : number);
    }

    function setDifferenceHTML(el, difference) {
      var color = difference > 0 ? 'success' : 'danger';
      color = difference === 0 ? 'primary' : color;
      var direction = difference > 0 ? 'up' : 'down';
      direction = difference === 0 ? 'up' : direction;
      var newClass = el.getAttribute('class').replace(/primary/g, color);

      el
        .setAttribute('class', newClass)
        .setInnerHTML('<i class="bi-graph-' + direction + '"></i> ' + difference.toFixed(2) + '%')
    }

    if (user && user.uid) {
      var statsUsersTotalPrevious = Manager.storage().get('admin.stats-users-total', 0);
      var statsUsersOnlinePrevious = Manager.storage().get('admin.stats-users-online', 0);
      var statsNotificationSubscribersPrevious = Manager.storage().get('admin.stats-notification-subscribers', 0);
      var statsPremiumSubscribersPrevious = Manager.storage().get('admin.stats-premium-subscribers', 0);

      statsUsersTotalPreviousEl.innerHTML = numberWithCommas(statsUsersTotalPrevious)
      statsUsersOnlinePreviousEl.innerHTML = numberWithCommas(statsUsersOnlinePrevious)
      statsNotificationSubscribersPreviousEl.innerHTML = numberWithCommas(statsNotificationSubscribersPrevious)
      statsPremiumSubscribersPreviousEl.innerHTML = numberWithCommas(statsPremiumSubscribersPrevious)

      user.getIdToken(false)
        .then(function(token) {

          // Get stats
          WonderfulFetch(serverProd, {
            method: 'POST',
            timeout: 30000,
            response: 'json',
            body: {
              authenticationToken: token,
              command: 'admin:get-stats',
              payload: {},
            },
          })
          .then(function (data) {
            console.log('Success', data);

            var statsUsersTotalDifference = calculateDifference(data.users.total, statsUsersTotalPrevious)
            var statsUsersOnlineDifference = calculateDifference(data.users.online, statsUsersOnlinePrevious)
            var statsNotificationSubscribersDifference = calculateDifference(data.notifications.total, statsNotificationSubscribersPrevious)
            var statsPremiumSubscribersDifference = calculateDifference(data.subscriptions.total, statsPremiumSubscribersPrevious)

            statsUsersTotalCurrentEl.innerHTML = numberWithCommas(data.users.total)
            statsUsersOnlineCurrentEl.innerHTML = numberWithCommas(data.users.online)
            statsNotificationSubscribersCurrentEl.innerHTML = numberWithCommas(data.notifications.total)
            statsPremiumSubscribersCurrentEl.innerHTML = numberWithCommas(data.subscriptions.total)

            setDifferenceHTML(statsUsersTotalIconEl, statsUsersTotalDifference)
            setDifferenceHTML(statsUsersOnlineIconEl, statsUsersOnlineDifference)
            setDifferenceHTML(statsNotificationSubscribersIconEl, statsNotificationSubscribersDifference)
            setDifferenceHTML(statsPremiumSubscribersIconEl, statsPremiumSubscribersDifference)

            Manager.storage().set('admin.stats-users-total', data.users.total);
            Manager.storage().set('admin.stats-users-online', data.users.online);
            Manager.storage().set('admin.stats-notification-subscribers', data.notifications.total);
            Manager.storage().set('admin.stats-premium-subscribers', data.subscriptions.total);
          })
          .catch(function (e) {
            Admin().display(e);
          });

          // Get sub data
          WonderfulFetch('https://us-central1-itw-creative-works.cloudfunctions.net/getApp', {
            method: 'POST',
            timeout: 30000,
            response: 'json',
            body: {
              id: Manager.properties.global.app,
            },
          })
          .then(function (app) {
            console.log('App', app);

            WonderfulFetch('https://us-central1-itw-creative-works.cloudfunctions.net/getSubscriptionTotals', {
              method: 'POST',
              timeout: 30000,
              response: 'json',
              body: {
                id: Manager.properties.global.app,
              },
            })
            .then(function (total) {
              console.log('Total', total);

              var subscriptions = [];
              var html = '';
              Object.keys(app.products)
              .forEach((key, i) => {
                var product = app.products[key];
                if (product.type === 'subscription' && product.monthly && product.monthly.price > 0) {
                  subscriptions = subscriptions.concat(product)
                }
              });

              subscriptions.sort(function (one, two) {
                if (one.monthly.price > two.monthly.price) {
                  return 1;
                } else if (one.monthly.price < two.monthly.price) {
                  return -1;
                } else  {
                  return 0;
                }
              })

              subscriptions.forEach((subscription, i) => {
                var count = total[subscription.planId] || {};
                count.total = count.total || 0;
                count.monthly = count.monthly || 0;
                count.annually = count.annually || 0;

                var percentMonthly = ((count.monthly / count.total) * 100 || 0);
                var percentAnnually = ((count.annually / count.total) * 100 || 0);

                html += subscriptionPlanTemplate
                  .replace(/{name}/img, subscription.name)
                  .replace(/{countTotal}/img, count.total)
                  .replace(/{countMonthly}/img, count.monthly)
                  .replace(/{countAnnually}/img, count.annually)
                  .replace(/{percentMonthly}/img, percentMonthly)
                  .replace(/{percentAnnually}/img, percentAnnually)
                  .replace(/{percentMonthlyVisual}/img, percentMonthly.toFixed(2))
                  .replace(/{percentAnnuallyVisual}/img, percentAnnually.toFixed(2))
              });

              subscriptionBreakdownParentEl.innerHTML = html;
              subscriptionBreakdownParentEl.removeAttribute('hidden')
              subscriptionBreakdownSpinnerEl.setAttribute('hidden', true)

            })
            .catch(function (e) {
              Admin().display(e);
            });

          })
          .catch(function (e) {
            Admin().display(e);
          });


        })
        .catch(function(e) {
          Admin().display(e);
        });


    }
  });

</script>
