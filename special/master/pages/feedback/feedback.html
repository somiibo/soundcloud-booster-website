---
### ALL PAGES ###
layout: master/global/default
permalink: /feedback/
sitemap:
  include: false

### REGULAR PAGES ###
head:
  post-bundle-css: '
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/bootstrap-icons/font/bootstrap-icons.css">

    <!-- CSS Front Template -->

    <link rel="stylesheet" href="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/css/theme.min.css" data-hs-appearance="default">
    <link rel="preload" href="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/css/theme-dark.min.css" data-hs-appearance="dark" as="style">

    <style data-hs-appearance-onload-styles>
      * {
        transition: unset !important;
      }
    </style>

    <style>
      /* body {
        align-items: center;
        display: flex;
        font-family: Helvetica, sans-serif;
        height: 100vh;
        justify-content: center;
        margin: 0;
      }
      body div {
        font-size: 15px;
        margin-top: 15px;
        text-align: center;
      } */

      #rating-system input[type=radio] {
        -webkit-appearance: none;
        width: 60px;
        height: 60px;
        border: none;
        cursor: pointer;
        transition: border 0.2s ease;
        filter: grayscale(100%);
        margin: 0 5px;
        transition: all 0.2s ease;
      }

      /* make rating system inputs smaller on smaller devices */
      @media (max-width: 576px) {
        #rating-system input[type=radio] {
          width: 45px;
          height: 45px;
        }
      }

      #rating-system input[type=radio]:hover, #rating-system input[type=radio]:checked {
        filter: grayscale(0);
      }
      #rating-system input[type=radio]:focus {
        outline: 0;
      }
      #rating-system input[type=radio].dislike {
        background: url("https://cdn.itwcreativeworks.com/assets/general/images/emojis/discord/angry.svg") center;
        background-size: cover;
      }
      #rating-system input[type=radio].neutral {
        background: url("https://cdn.itwcreativeworks.com/assets/general/images/emojis/discord/neutral_face.svg") center;
        background-size: cover;
      }
      #rating-system input[type=radio].like {
        background: url("https://cdn.itwcreativeworks.com/assets/general/images/emojis/discord/slight_smile.svg") center;
        background-size: cover;
      }
      #rating-system input[type=radio].love {
        background: url("https://cdn.itwcreativeworks.com/assets/general/images/emojis/discord/heart_eyes.svg") center;
        background-size: cover;
      }            
    </style>
  '

foot:
  post-bundle-script: '

    <!-- Theme  -->
    {%- include /master/vendor/front-admin/v2/js/theme-prefix.html -%}

    <!-- JS Global Compulsory  -->
    <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/jquery-migrate/dist/jquery-migrate.min.js"></script>
    <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JS Implementing Plugins -->
    <!-- <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/hs-toggle-password/dist/js/hs-toggle-password.js"></script> -->

    <!-- JS Front -->
    <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/js/theme.min.js"></script>

    <!-- ITW CW -->
    <script type="text/javascript" src="/assets/js/master.js?cb={{ site.time | date: "%s" }}" async defer></script>
    {%- include /master/misc/embed-manager.html -%}

  '

settings:
  include-app-foot: false
  include-app-head: false
  include-app-footer: false
  include-app-header: false
  include-script-bundle: false
  include-script-core: true
  include-css-bundle: false
  manager-configuration: "
    {
      auth: {
        state: 'required',
        sends: {
          required: '/authentication/signup/',
        },
      },      
      libraries: {
        cookieconsent: {
          enabled: false,
        },
        chatsy: {
          enabled: false,
        },
        lazysizes: {
          enabled: false,
        },
      },
    }
  "

### REGULAR PAGES ###
meta:
  title: "Feedback - {{ site.brand.name }}"
  description: "Provide feedback to the  {{ site.brand.name }} team and help us improve our product for you."
  breadcrumb: "Feedback"
  index: false 
---
<main id="content" role="main" class="main">
  <div class="position-fixed top-0 end-0 start-0 bg-img-start" style="height: 32rem; background-image: url(./assets/svg/components/card-6.svg);">
    <!-- Shape -->
    <div class="shape shape-bottom zi-1">
      <svg preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 1921 273">
        <polygon fill="#fff" points="0,273 1921,273 1921,0 " />
      </svg>
    </div>
    <!-- End Shape -->
  </div>

  <!-- Content -->
  <div class="container py-5 py-sm-7">
    <a class="d-flex justify-content-center mb-5" href="{{ site.url }}" target="_blank">
      <img class="zi-2" id="main-logo" src="{{ site.brand.logo-image-svg }}?cb={{ site.time | date: '%s' }}" alt="{{ site.brand.name }}" style="width: 8rem;">
    </a>

    <div class="mx-auto" style="max-width: 30rem;">
      <!-- Card -->
      <div class="card card-lg mb-5">
        <div class="card-body">

          <div class="d-flex justify-content-center">
            <div id="spinner" class="spinner-border text-primary mb-3" role="status"></div>
          </div>

          <div id="feedback-parent" hidden>

            <div class="text-center">
              <div class="mb-5">
                <h1 class="display-5">{{ site.brand.name }} Feedback</h1>
                <p>We'd love to know how we're doing!</p>
              </div>
            </div>

            <form id="feedback-form" class="js-validate" onsubmit="return false;">
              <div class="row">
                <div class="col-12 mb-3">
                  <label class="form-label" for="feedback-like">What do you <b>like</b>?</label>
                  <textarea id="feedback-like" name="like" class="form-control" placeholder="Tell us what you like about {{ site.brand.name }}" rows="2" autofocus></textarea>
                </div>

                <div class="col-12 mb-3">
                  <label class="form-label" for="feedback-like">What do you <b>dislike</b>?</label>
                  <textarea id="feedback-like" name="dislike" class="form-control" placeholder="Tell us what you dislike about {{ site.brand.name }}" rows="2"></textarea>
                </div>

                <div class="col-12 mb-3">
                  <label class="form-label" for="feedback-like">What would you <b>change</b>?</label>
                  <textarea id="feedback-like" name="change" class="form-control" placeholder="Tell us what you would add to or change about {{ site.brand.name }}" rows="2"></textarea>
                </div>                

                <div class="col-12 mb-3">
                  <label class="form-label" for="feedback-rating">Overall, how is your experience with <b>{{ site.brand.name }}</b>?</label>

                  <div id="rating-system" class="d-flex justify-content-between">
                    <input type="radio" name="rating" value="dislike" class="dislike">
                    <input type="radio" name="rating" value="neutral" class="neutral" checked="checked">
                    <input type="radio" name="rating" value="like" class="like">
                    <input type="radio" name="rating" value="love" class="love">
                  </div>

                  <!-- <div>I have a <span id="rating-result">neutral</span> feeling about <b>{{ site.brand.name }}</b></div> -->

                </div>

                <div class="mb-3"></div>

                <div class="d-grid gap-2">
                  <button type="submit" class="btn btn-primary btn-lg" disabled>
                    <i class="fa-solid fa-paper-plane me-1"></i>
                    Submit Feedback
                  </button>
                </div>                

              </div>

            </form>
          </div>
          <!-- End Form -->
        </div>
      </div>
      <!-- End Card -->

    </div>
  </div>
  <!-- End Content -->
</main>

<div class="position-fixed start-50 bottom-0 translate-middle-x w-100 zi-99 mb-sm-0 mb-md-5 text-center">
  <div class="row">
    <div class="col-sm-12 col-md-6 offset-md-3">
      <div id="result" class="alert alert-danger auth-error-message-element mb-0" role="alert" hidden> </div>
    </div>
  </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 2000">
  <div id="toast-copy" class="toast align-items-center bg-success text-white" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Copied!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-success" tabindex="-1" role="dialog" aria-labelledby="successModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="successModal">Thank you for your review!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-dark">Wowâ€”thank you so much for the feedback!</p>

        <p class="text-dark">Would you be interested in posting your feedback as review for <strong>{{ site.brand.name }}</strong>?</p>

        <p class="text-dark">Reviews help us attract new users and allow us to <strong>invest more in our service to you</strong>!</p>

        <div class="row">
          <div class="col-12 mb-3">
            <div class="d-flex justify-content-between mb-2">
              <label class="form-label mb-0" for="review-text">Here's what you wrote:</label>
              <a href="javascript:;" id="copy-review-btn" class="btn btn-primary py-0">Copy</a>
            </div>
            <textarea id="review-text" name="change" class="form-control" disabled style="resize: none;"></textarea>
          </div>   
        </div>
      
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-bs-dismiss="modal">No thanks</button>
        <a id="review-url" type="button" class="btn btn-success" href="" target="_blank">Go to review site</a>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/wonderful-fetch@latest/dist/index.min.js?cb={{ site.time | date: "%s" }}"></script>

<script type="text/javascript">

  Manager.auth().ready(function () {
    var select = Manager.dom().select;
    var _ = Manager.utilities();
    var user = firebase.auth().currentUser;
    var url = new URL(window.location.href);

    var $spinner = select('#spinner');
    var $feedbackParent = select('#feedback-parent');
    var $feedbackForm = document.getElementById('feedback-form');
    var $feedbackFormInputs = select($feedbackForm.querySelectorAll('input, textarea, select'))
    var $result = select('#result');
    var $submitButton = select('#feedback-form button[type="submit"]');
    var $reviewUrl = select('#review-url');

    var $reviewText = document.getElementById('review-text');
    var $reviewModal = new bootstrap.Modal(document.getElementById('modal-success'));
    var $toastCopy = new bootstrap.Toast(document.getElementById('toast-copy'));

    var isDeveloper = Manager.properties.meta.environment === 'development';

    var serverAPIUrl = (
      isDeveloper
        ? 'http://localhost:5001/PROJECT_ID/us-central1/bm_api'
        : 'https://us-central1-PROJECT_ID.cloudfunctions.net/bm_api'
    )
    .replace(/PROJECT_ID/g, _.get(Manager, 'properties.options.libraries.firebase_app.config.projectId'))

    if (!user) {
      return;
    }

    $spinner.setAttribute('hidden', true);
    $feedbackParent.removeAttribute('hidden');

    $feedbackForm.addEventListener('submit', function (event) {
      event.preventDefault();

      var data = getFormData();
      var user = firebase.auth().currentUser;

      console.log('submit', data, user);

      // Validate data
      if (!user || !user.uid) {
        return display(new Error('You must be logged in to submit feedback.'));
      }

      // Validate data
      if (
        data.like.length < 10
        || data.dislike.length < 3
        || data.change.length < 3
        || !data.rating
      ) {
        return display(new Error('Please fill out all fields and provide at least one sentence for each field.'))
      }

      // Submit data to server
      display('loading');

      user.getIdToken(false)
      .then(function (token) {
        // Preprocess data
        // data.owner = data.owner || {};
        // data.owner.uid = data.owner.uid || user.uid;

        // Send data to server
        WonderfulFetch(serverAPIUrl, {
          method: 'post',
          response: 'json',
          body: {
            authenticationToken: token,
            command: 'user:submit-feedback',
            payload: data,
          },
        })
        .then(function (response) {
          console.log('Success', response);
 
          display('Thank you so much for your feedback! We rely on your responses to improve the service.');

          if (response && response.review && response.review.promptReview) {
            $reviewText.value = response.originalRequest.like;
            $reviewModal.show();
            $reviewUrl.setAttribute('href', response.review.reviewURL);
          }
 
        })
        .catch(function (e) {
          console.error('Error', e);
          display(e);
        })        
      })
    })

    // click handler
    document.addEventListener('click', function (event) {
      if (event.target.matches('#copy-review-btn')) {
        $reviewText.select();
        Manager.utilities().clipboardCopy($reviewText.value);
        $toastCopy.show();
      }
    })

    // on input change, auto grrow textarea
    document.addEventListener('input', function (event) {
      if (event.target.matches('textarea')) {
        autoGrow(event.target)
      }
    }, false);

    // on bootstrap modal show
    document.addEventListener('shown.bs.modal', function (event) {
      autoGrow($reviewText)
    })

    function display(type) {
      type = type || 'ready';

      $result.setAttribute('hidden', true)
        .removeClass('alert-danger')
        .removeClass('alert-success')
      $submitButton.removeAttribute('disabled');

      if (type === 'ready') {
        // $result.innerHTML = 'Thank you for your feedback!';
        setTimeout(function () {
          document.querySelector('#feedback-form [name="like"]').select();
        }, 1);
      } else if (type === 'loading') {
        $submitButton.setAttribute('disabled', true);
      } else if (type instanceof Error) {
        $result.removeAttribute('hidden')
          .addClass('alert-danger')
          .setInnerHTML(type.message)
      } else {
        $submitButton.setAttribute('disabled', true);
        $result.removeAttribute('hidden')
          .addClass('alert-success')
          .setInnerHTML(type)
      }

      console.log('display', type);
    }

    function getFormData() {
      var data = {};
      
      $feedbackFormInputs
      .each(function (el) {
        el = Manager.dom().select(el);
        var name = el.getAttribute('name');
        var value = el.getValue();

        data[name] = typeof data[name] === 'undefined' ? value : data[name];
      })     

      return data; 
    }

    function autoGrow(element) {
      element.style.height = '5px';
      element.style.height = Math.max(62, element.scrollHeight) + 'px';
    }    

    if (isDeveloper) {
      select($feedbackForm.querySelectorAll('input, select, textarea'))
      .each(function (el) {
        select(el).setValue('test ' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15));
      })
    }

    // Display initial state
    display()
  });
</script>
