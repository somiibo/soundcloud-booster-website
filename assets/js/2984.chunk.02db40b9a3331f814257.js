"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[2984],{2984:(t,e,s)=>{s.d(e,{A:()=>i});class i extends EventTarget{constructor(t,e={}){if(super(),this.hasCustomInitialState=e.hasOwnProperty("initialState"),this.config={autoDisable:!0,showSpinner:!0,validateOnSubmit:!0,allowMultipleSubmissions:!0,resetOnSuccess:!1,spinnerHTML:'<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>',submitButtonLoadingText:"Processing...",submitButtonSuccessText:null,fieldErrorClass:"is-invalid",fieldSuccessClass:"is-valid",initialState:"loading",toastPosition:"top-center",toastDuration:5e3,...e},this.form="string"==typeof t?document.querySelector(t):t,!this.form)throw new Error(`Form not found: ${t}`);this.state={status:"loading",isValid:!0,errors:{},data:{},isDirty:!1},this.originalButtonStates=new Map,this.init()}init(){this.form.querySelectorAll("button").forEach(t=>{const e={innerHTML:t.innerHTML,disabled:t.disabled};this.originalButtonStates.set(t,e)}),this.clickedSubmitButton=null,this.isInitializing=!0,this.setFormState(this.config.initialState),this.attachEventListeners(),window.addEventListener("pageshow",t=>{console.log("[FormManager] pageshow event",t),t.persisted&&(console.log("[FormManager] Page restored from cache, resetting form to ready state"),"submitting"===this.state.status&&this.setFormState("ready"))}),this.hasCustomInitialState?this.isInitializing=!1:"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.isInitializing=!1,this.setFormState("ready")}):setTimeout(()=>{this.isInitializing=!1,this.setFormState("ready")},0)}attachEventListeners(){this.form.addEventListener("submit",t=>this.handleSubmit(t));const t=["keyup","change","paste","cut"],e=t=>this.handleChange(t);this.form.querySelectorAll("input, select, textarea").forEach(s=>{t.forEach(t=>{s.addEventListener(t,e)})}),this.form.querySelectorAll('button[type="button"]').forEach(t=>{t.addEventListener("click",t=>this.handleButtonClick(t))}),this.form.querySelectorAll('button[type="submit"]').forEach(t=>{t.addEventListener("click",t=>{this.clickedSubmitButton=t.currentTarget})})}async handleSubmit(t){if(t.preventDefault(),"submitting"===this.state.status&&!this.config.allowMultipleSubmissions)return;this.clearErrors();const e=this.collectFormData(),s=new CustomEvent("submit",{detail:{data:e,form:this.form,submitButton:this.clickedSubmitButton},cancelable:!0});if(console.log("-----1"),this.config.validateOnSubmit){console.log("-----2");const t=this.validate(e);if(!t.isValid){console.log("-----3"),this.showErrors(t.errors);const e=Object.keys(t.errors).length,s=1===e?"Please correct the error below":`Please correct the ${e} errors below`;return void this.showNotification(s,"danger")}}if(this.setFormState("submitting"),this.dispatchEvent(s),this.clickedSubmitButton=null,!s.defaultPrevented)try{await this.defaultSubmitHandler(e),this.config.allowMultipleSubmissions?this.setFormState("ready"):this.setFormState("submitted"),this.dispatchEvent(new CustomEvent("success",{detail:{data:e}})),this.config.resetOnSuccess&&this.reset()}catch(t){this.setFormState("ready"),this.showError(t.message),this.dispatchEvent(new CustomEvent("error",{detail:{error:t,data:e}}))}}async defaultSubmitHandler(t){console.log("Form submitted with data:",t),await new Promise(t=>setTimeout(t,1e3))}handleChange(t){const e=t.target;e.classList.contains(this.config.fieldErrorClass)&&this.clearFieldError(e),this.changeTimeouts?clearTimeout(this.changeTimeouts.get(e)):this.changeTimeouts=new Map,this.changeTimeouts.set(e,setTimeout(()=>{this.state.isDirty=!0;const s=this.collectFormData(),i=this.getFieldValue(e);this.dispatchEvent(new CustomEvent("change",{detail:{field:e,fieldName:e.name,fieldValue:i,data:s,event:t}})),this.changeTimeouts.delete(e)},100))}handleButtonClick(t){const e=t.currentTarget,s=e.getAttribute("data-action")||e.id;this.dispatchEvent(new CustomEvent("button",{detail:{button:e,action:s,data:this.collectFormData()}}))}setFormState(t){const e=this.state.status;switch(this.state.status=t,this.form.setAttribute("data-form-state",t),t){case"loading":this.disableForm();break;case"ready":this.enableForm(),this.hideSubmittingState();break;case"submitting":this.disableForm(),this.showSubmittingState();break;case"submitted":this.config.resetOnSuccess||this.disableForm(),this.hideSubmittingState(),this.config.submitButtonSuccessText&&!this.config.allowMultipleSubmissions&&this.showSuccessButtonText()}this.dispatchEvent(new CustomEvent("statechange",{detail:{status:t,previousStatus:e}}))}disableForm(){this.config.autoDisable&&this.form.querySelectorAll("input, select, textarea, button").forEach(t=>{t.disabled=!0})}enableForm(){if(!this.config.autoDisable)return;this.form.querySelectorAll("input, select, textarea, button").forEach(t=>{const e=this.originalButtonStates.get(t);"submit"!==t.type&&e&&e.disabled||(t.disabled=!1)});const t=this.form.querySelector("[autofocus]");t&&!t.disabled&&t.focus()}showSubmittingState(){this.config.showSpinner&&this.form.querySelectorAll('button[type="submit"]').forEach(t=>{this.originalButtonStates.get(t)&&(t.innerHTML=this.config.spinnerHTML+this.config.submitButtonLoadingText)})}hideSubmittingState(){this.form.querySelectorAll('button[type="submit"]').forEach(t=>{const e=this.originalButtonStates.get(t);e&&(t.innerHTML=e.innerHTML)})}showSuccessButtonText(){this.config.submitButtonSuccessText&&this.form.querySelectorAll('button[type="submit"]').forEach(t=>{const e=t.querySelector(".button-text");e?e.textContent=this.config.submitButtonSuccessText:t.textContent=this.config.submitButtonSuccessText})}setNestedValue(t,e,s){if(!e.includes("."))return void(t[e]=s);const i=e.split("."),a=i.pop();let r=t;for(const t of i)r[t]&&"object"==typeof r[t]||(r[t]={}),r=r[t];r[a]=s}getNestedValue(t,e){if(!e.includes("."))return t[e];const s=e.split(".");let i=t;for(const t of s){if(null==i||"object"!=typeof i)return;i=i[t]}return i}collectFormData(){const t=new FormData(this.form),e={};for(const[s,i]of t.entries()){const t=this.getNestedValue(e,s);void 0!==t?Array.isArray(t)?t.push(i):this.setNestedValue(e,s,[t,i]):this.setNestedValue(e,s,i)}return this.form.querySelectorAll('input[type="checkbox"]').forEach(t=>{const s=t.name;t.checked||void 0===this.getNestedValue(e,s)&&(this.form.querySelectorAll(`input[type="checkbox"][name="${s}"]`)[1]||this.setNestedValue(e,s,!1))}),this.form.querySelectorAll('input[type="radio"]:checked').forEach(t=>{this.setNestedValue(e,t.name,t.value)}),this.state.data=e,e}getFieldValue(t){const e="string"==typeof t?this.form.querySelector(`[name="${t}"]`):t;if(e){if("checkbox"===e.type){const t=this.form.querySelectorAll(`input[type="checkbox"][name="${e.name}"]`);return t.length>1?Array.from(t).filter(t=>t.checked).map(t=>t.value):e.checked}return"radio"===e.type?this.form.querySelector(`input[name="${e.name}"]:checked`)?.value:e.value}}validate(t){const e={};let s=!0;this.form.querySelectorAll("[required]").forEach(i=>{const a=this.getNestedValue(t,i.name);a&&("string"!=typeof a||a.trim())||(e[i.name]=`${this.getFieldLabel(i)} is required`,s=!1)}),this.form.querySelectorAll('input[type="email"]').forEach(i=>{const a=this.getNestedValue(t,i.name);a&&!this.isValidEmail(a)&&(e[i.name]="Please enter a valid email address",s=!1)}),this.form.querySelectorAll("[pattern]").forEach(i=>{const a=this.getNestedValue(t,i.name),r=new RegExp(i.pattern);a&&!r.test(a)&&(e[i.name]=i.title||"Invalid format",s=!1)}),this.form.querySelectorAll("[minlength]").forEach(i=>{const a=this.getNestedValue(t,i.name),r=parseInt(i.minLength);a&&a.length<r&&(e[i.name]=`${this.getFieldLabel(i)} must be at least ${r} characters`,s=!1)}),this.form.querySelectorAll("[maxlength]").forEach(i=>{const a=this.getNestedValue(t,i.name),r=parseInt(i.maxLength);a&&a.length>r&&(e[i.name]=`${this.getFieldLabel(i)} must be no more than ${r} characters`,s=!1)}),this.form.querySelectorAll('input[type="number"][min]').forEach(i=>{const a=this.getNestedValue(t,i.name),r=parseFloat(i.min),o=parseFloat(a);!isNaN(o)&&o<r&&(e[i.name]=`${this.getFieldLabel(i)} must be at least ${r}`,s=!1)}),this.form.querySelectorAll('input[type="number"][max]').forEach(i=>{const a=this.getNestedValue(t,i.name),r=parseFloat(i.max),o=parseFloat(a);!isNaN(o)&&o>r&&(e[i.name]=`${this.getFieldLabel(i)} must be no more than ${r}`,s=!1)});const i=new CustomEvent("validate",{detail:{data:t,errors:e},cancelable:!0});return this.dispatchEvent(i),this.state.isValid=s,this.state.errors=e,{isValid:s,errors:e}}getFieldLabel(t){const e=this.form.querySelector(`label[for="${t.id}"]`);return e?e.textContent.replace("*","").trim():t.name.replace(/[_-]/g," ").replace(/\b\w/g,t=>t.toUpperCase())}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}showErrors(t){this.clearErrors();let e=null;Object.entries(t).forEach(([t,s])=>{const i=this.form.querySelector(`[name="${t}"]`);if(i){i.classList.add(this.config.fieldErrorClass),e||(e=i);const t=document.createElement("div");t.className="invalid-feedback",t.textContent=s;const a=i.closest(".input-group")||i;a.parentNode.insertBefore(t,a.nextSibling)}}),e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}));const s=Object.entries(t).filter(([t])=>!this.form.querySelector(`[name="${t}"]`));if(s.length>0){const t=s.map(([t,e])=>e).join(", ");this.showNotification(t,"danger")}}showNotification(t,e="info"){const s=document.createElement("div");s.className=`alert alert-${e} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-5 animation-slide-down`,s.style.zIndex="9999",s.innerHTML=`\n      ${t}\n      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    `,document.body.appendChild(s),setTimeout(()=>{s.remove()},5e3)}showError(t){let e;t instanceof Error?(e=t.message,console.error("FormManager Error:",t)):(e=t,console.error("FormManager Error:",e)),this.showNotification(e,"danger")}clearErrors(){this.form.querySelectorAll(`.${this.config.fieldErrorClass}`).forEach(t=>{t.classList.remove(this.config.fieldErrorClass)}),this.form.querySelectorAll(".invalid-feedback").forEach(t=>t.remove())}clearFieldError(t){t.classList.remove(this.config.fieldErrorClass);const e=t.parentElement.querySelector(".invalid-feedback")||t.closest(".input-group")?.parentElement.querySelector(".invalid-feedback");e&&e.remove(),this.state.errors&&t.name&&delete this.state.errors[t.name]}showSuccess(t){this.showNotification(t,"success")}reset(){this.form.reset(),this.state.isDirty=!1,this.state.data={},this.state.errors={},this.clearErrors(),this.setFormState("ready")}setFieldValue(t,e){const s=this.form.querySelector(`[name="${t}"]`);if(s){if("checkbox"===s.type)s.checked=!!e;else if("radio"===s.type){const s=this.form.querySelector(`[name="${t}"][value="${e}"]`);s&&(s.checked=!0)}else s.value=e;this.setNestedValue(this.state.data,t,e),s.dispatchEvent(new Event("change",{bubbles:!0}))}}getValue(t){return this.getNestedValue(this.state.data,t)}disableField(t){const e=this.form.querySelector(`[name="${t}"]`);e&&(e.disabled=!0)}enableField(t){const e=this.form.querySelector(`[name="${t}"]`);e&&(e.disabled=!1)}getData(){return this.collectFormData()}flattenObject(t,e=""){const s={};for(const[i,a]of Object.entries(t)){const t=e?`${e}.${i}`:i;!a||"object"!=typeof a||Array.isArray(a)||a instanceof Date?s[t]=a:Object.assign(s,this.flattenObject(a,t))}return s}setValues(t){if(!t||"object"!=typeof t)return;const e=this.flattenObject(t);Object.entries(e).forEach(([t,e])=>{const s=this.form.querySelector(`[name="${t}"]`)||this.form.querySelector(`#${t}`)||this.form.querySelector(`#${t}-input`)||this.form.querySelector(`#${t}-select`);if(!s)return;if("checkbox"===s.type)s.checked=!!e;else if("radio"===s.type)this.form.querySelectorAll(`[name="${t}"]`).forEach(t=>{t.checked=t.value===e});else if("SELECT"===s.tagName){if(s.value=e,!s.value&&e){const t=Array.from(s.options).find(t=>t.text.toLowerCase()===e.toLowerCase());t&&(s.value=t.value)}}else s.value=e||"";const i=new Event("change",{bubbles:!0});s.dispatchEvent(i)}),this.state.data=this.collectFormData()}getState(){return{...this.state}}isDirty(){return this.state.isDirty}isValid(){return this.validate(this.collectFormData()).isValid}}}}]);