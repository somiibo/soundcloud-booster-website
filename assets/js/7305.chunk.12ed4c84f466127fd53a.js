"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[7305],{7305:(e,t,n)=>{n.r(t),n.d(t,{init:()=>u,loadData:()=>d});var i=n(4289),o=n.n(i),s=n(2984);let a=null,c=null,r=new Map,l=null;function u(e){a=e,async function(){c=a.firebaseAuth,async function(){try{const{getRedirectResult:e}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),t=await e(c);t&&t.user&&(a.utilities().showNotification("Google account connected successfully","success"),m())}catch(e){e.code&&"auth/no-auth-event"!==e.code&&(console.error("Redirect result error:",e),a.utilities().showNotification("Failed to connect Google account","danger"))}}(),m()}(),function(){const e=document.getElementById("signin-method-password-form");if(e&&!r.has("password")){const t=new s.A(e,{allowMultipleSubmissions:!1,autoDisable:!0,showSpinner:!0,submitButtonSuccessText:"Email Sent"});r.set("password",t),t.addEventListener("submit",async()=>{try{await async function(){try{const e=a.auth().getUser();if(!e||!e.email)throw new Error("Please log in to reset your password.");const{sendPasswordResetEmail:t}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480));await t(c,e.email),a.utilities().showNotification("Password reset email sent. Please check your inbox.","info")}catch(e){throw console.error("Failed to send password reset:",e),new Error(e.message||"Failed to send password reset email. Please try again.")}}()}catch(e){t.showError(e),t.setFormState("ready")}})}const t=document.getElementById("signin-method-google-form");if(t&&!r.has("google")){const e=new s.A(t,{autoDisable:!0,showSpinner:!0});r.set("google",e),e.addEventListener("submit",async t=>{t.preventDefault();const{data:i}=t.detail;try{"disconnect"===i.action?await async function(){if(await new Promise(e=>setTimeout(e,1)),!confirm("Are you sure you want to disconnect your Google account?"))throw new Error("Disconnection cancelled");const{unlink:e}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),t=c.currentUser;if(t.providerData.length<=1)throw new Error("Cannot disconnect Google. You need at least one sign-in method.");try{await e(t,"google.com"),a.utilities().showNotification("Google account disconnected successfully","success")}catch(e){throw"auth/no-such-provider"===e.code?new Error("Google account is not connected"):e}}():await async function(){const{GoogleAuthProvider:e,linkWithPopup:t,linkWithRedirect:i}=await Promise.all([n.e(9943),n.e(7480)]).then(n.bind(n,7480)),o=new e;try{const e=await t(c.currentUser,o);return a.utilities().showNotification("Google account connected successfully","success"),await c.currentUser.reload(),e}catch(e){if("auth/popup-blocked"!==e.code&&"auth/popup-closed-by-user"!==e.code&&"auth/cancelled-popup-request"!==e.code)throw"auth/credential-already-in-use"===e.code?new Error("This Google account is already linked to another user"):e;console.log("Popup failed, falling back to redirect:",e.code);try{await i(c.currentUser,o)}catch(e){throw e}}}(),e.setFormState("ready"),setTimeout(()=>{m()},0)}catch(t){e.setFormState("ready"),"Disconnection cancelled"===t.message?setTimeout(()=>{m()},0):e.showError(t)}})}const i=document.getElementById("2fa-btn");i&&i.addEventListener("click",p)}(),function(){const e=document.getElementById("signout-all-sessions-form");e&&!l&&(l=new s.A(e,{autoDisable:!0,showSpinner:!0}),l.addEventListener("submit",async e=>{e.preventDefault();try{if(!confirm("Are you sure you want to sign out of all sessions? This will log you out everywhere, including this device."))throw new Error("Sign out cancelled");await a.auth().signOut(),a.utilities().showNotification("Successfully signed out of all sessions.","success")}catch(e){"Sign out cancelled"!==e.message&&l.showError(e),l.setFormState("ready")}}))}()}function d(e){e&&(m(),function(e){const t=document.getElementById("2fa-status"),n=document.getElementById("2fa-btn");e?.enabled?(t&&(t.innerHTML='<span class="badge bg-success">Enabled</span>'),n&&(n.textContent="Manage 2FA",n.className="btn btn-outline-primary")):(t&&(t.innerHTML='<span class="badge bg-secondary">Disabled</span>'),n&&(n.textContent="Enable 2FA",n.className="btn btn-primary"))}(e.security?.twoFactor),async function(e){const t=document.getElementById("active-sessions-list");if(!t)return;const n=[];if(e?.activity){const t={isCurrent:!0,device:f(e.activity.client?.userAgent),browser:g(e.activity.client?.userAgent),platform:e.activity.client?.platform,mobile:e.activity.client?.mobile,language:e.activity.client?.language,ip:e.activity.geolocation?.ip,city:e.activity.geolocation?.city,region:e.activity.geolocation?.region,country:e.activity.geolocation?.country,timestamp:e.activity.created?.timestamp,timestampUNIX:e.activity.created?.timestampUNIX};n.push(t)}try{const e=await a.auth().getIdToken(),t=a.getApiUrl()+"/backend-manager",i=await o()(t,{method:"POST",timeout:6e4,response:"json",tries:2,body:{authenticationToken:e,command:"user:get-active-sessions",payload:{}}});console.log("Active sessions data from server:",i);let s=i||{};if("true"===new URLSearchParams(window.location.search).get("_test_prefill")){console.log("Adding fake session data for testing");const e=function(){const e=Date.now(),t=864e5;return{session_abc123:{_current:!1,platform:"Windows",ip:"98.137.246.8",timestamp:new Date(e-108e5).toISOString(),timestampUNIX:Math.floor((e-108e5)/1e3)},session_def456:{_current:!1,platform:"Darwin",ip:"192.168.1.42",timestamp:new Date(e-288e5).toISOString(),timestampUNIX:Math.floor((e-288e5)/1e3)},session_ghi789:{_current:!1,platform:"Linux",ip:"45.62.189.3",timestamp:new Date(e-t).toISOString(),timestampUNIX:Math.floor((e-t)/1e3)},session_jkl012:{_current:!1,platform:"Win32",ip:"203.0.113.45",timestamp:new Date(e-2*t).toISOString(),timestampUNIX:Math.floor((e-2*t)/1e3)},session_mno345:{_current:!1,platform:"Mac",ip:"172.217.16.195",timestamp:new Date(e-5*t).toISOString(),timestampUNIX:Math.floor((e-5*t)/1e3)}}}();s={...e,...s}}s&&"object"==typeof s&&Object.keys(s).forEach(e=>{const t=s[e];if(t._current)return;const i={isCurrent:!1,sessionId:e,platform:t.platform,ip:t.ip,timestamp:t.timestamp,timestampUNIX:t.timestampUNIX,device:w(t.platform),browser:"App • Desktop",mobile:void 0};n.push(i)})}catch(e){console.error("Failed to get active sessions:",e)}if(e?.lastActivity){const t={isCurrent:!1,device:f(e.lastActivity.client?.userAgent),browser:g(e.lastActivity.client?.userAgent),platform:e.lastActivity.client?.platform,mobile:e.lastActivity.client?.mobile,language:e.lastActivity.client?.language,ip:e.lastActivity.geolocation?.ip,city:e.lastActivity.geolocation?.city,region:e.lastActivity.geolocation?.region,country:e.lastActivity.geolocation?.country,timestamp:e.lastActivity.timestamp,timestampUNIX:e.lastActivity.timestampUNIX};n[0]&&t.ip===n[0].ip&&t.timestampUNIX===n[0].timestampUNIX||n.push(t)}if(0===n.length)return void(t.innerHTML='<p class="text-muted text-center py-3">No active sessions found.</p>');const i=n.map(e=>{const t=e.device||"Unknown Device",n=e.browser||"Unknown Browser",i=function(e){const t=[];if(e.city){const n=e.city.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");t.push(n)}return e.region&&t.push(e.region.toUpperCase()),e.country&&t.push(e.country.toUpperCase()),t.length>0?t.join(", "):null}(e);return`\n    <div class="list-group-item px-0 bg-body-tertiary">\n      <div class="d-flex justify-content-between align-items-start">\n        <div class="d-flex align-items-start">\n          <div class="me-3 mt-1">\n            ${function(e){const t=(e||"").toLowerCase();return t.includes("iphone")||t.includes("ipad")||t.includes("ios")||t.includes("mac")?'<i class="fa-brands fa-apple fa-lg"></i>':t.includes("android")?'<i class="fa-brands fa-android fa-lg"></i>':t.includes("windows")?'<i class="fa-brands fa-windows fa-lg"></i>':t.includes("linux")?'<i class="fa-brands fa-linux fa-lg"></i>':t.includes("chrome")?'<i class="fa-brands fa-chrome fa-lg"></i>':'<i class="fa-solid fa-desktop fa-lg"></i>'}(e.platform||t)}\n          </div>\n          <div>\n            <div class="fw-semibold">${t}</div>\n            <small class="text-muted d-block">${n}${void 0!==e.mobile?" • "+(e.mobile?"Mobile":"Desktop"):""}</small>\n            ${i?`<small class="text-muted d-block">${i}</small>`:""}\n            ${e.ip?`<small class="text-muted d-block">IP: ${e.ip}</small>`:""}\n          </div>\n        </div>\n        <div class="text-end">\n          <small class="text-muted">${function(e){if(!e)return"Unknown";const t=new Date(e),n=new Date-t;if(n<6e4)return"Just now";if(n<36e5){const e=Math.floor(n/6e4);return`${e} minute${e>1?"s":""} ago`}if(n<864e5){const e=Math.floor(n/36e5);return`${e} hour${e>1?"s":""} ago`}if(n<6048e5){const e=Math.floor(n/864e5);return`${e} day${e>1?"s":""} ago`}return t.toLocaleDateString()+" at "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}(e.timestamp||1e3*e.timestampUNIX)}</small>\n          ${e.isCurrent?'<span class="badge bg-primary ms-2">Current</span>':""}\n        </div>\n      </div>\n    </div>\n  `}).join("");t.innerHTML=i}(e))}async function m(){const e=c?.currentUser;if(!e)return;const t=a.auth().getUser();if(!t)return;const n=document.getElementById("password-email");if(n){const i=e.providerData?.some(e=>"password"===e.providerId);n.textContent=i?t.email:"Not set"}const i=document.getElementById("google-email"),o=document.getElementById("signin-method-google-form"),s=o?.querySelector('button[type="submit"]'),r=s?.querySelector(".button-text"),l=o?.querySelector('input[name="action"]'),u=s?.querySelector(".fa-icon");if(i&&s){const t=e.providerData?.find(e=>"google.com"===e.providerId);t?(i.textContent=t.email||"Connected",r&&(r.textContent="Disconnect"),l&&(l.value="disconnect"),s.classList.remove("btn-primary"),s.classList.add("btn-outline-danger"),u&&(u.classList.remove("fa-link"),u.classList.add("fa-unlink"))):(i.textContent="Not connected",r&&(r.textContent="Connect"),l&&(l.value="connect"),s.classList.remove("btn-outline-danger"),s.classList.add("btn-primary"),u&&(u.classList.remove("fa-unlink"),u.classList.add("fa-link")))}}async function p(e){e.target.textContent.includes("Enable")?console.log("Starting 2FA setup..."):console.log("Managing 2FA settings...")}function f(e){if(!e)return"Unknown Device";const t=e.toLowerCase();return t.includes("iphone")?"iPhone":t.includes("ipad")?"iPad":t.includes("android")?t.includes("mobile")?"Android Phone":t.includes("tablet")?"Android Tablet":"Android Device":t.includes("windows phone")?"Windows Phone":t.includes("mac os x")||t.includes("macintosh")?"Mac":t.includes("windows nt")?"Windows PC":t.includes("linux")?"Linux":t.includes("cros")?"Chromebook":"Unknown Device"}function g(e){if(!e)return"Unknown Browser";const t=e.toLowerCase();return t.includes("edg/")?"Microsoft Edge":t.includes("chrome/")&&!t.includes("edg/")?"Chrome":t.includes("firefox/")?"Firefox":!t.includes("safari/")||t.includes("chrome/")||t.includes("edg/")?t.includes("opera/")||t.includes("opr/")?"Opera":t.includes("brave/")?"Brave":"Unknown Browser":"Safari"}function w(e){if(!e)return"Unknown Device";const t=e.toLowerCase();return t.includes("mac")||t.includes("darwin")?"macOS":t.includes("win")?"Windows":t.includes("linux")?"Linux":t.includes("android")?"Android":t.includes("ios")||t.includes("iphone")||t.includes("ipad")?"iOS":"Unknown"}}}]);